<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Audio Demo</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: system-ui;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%
        }

        h1 {
            margin: 0 0 10px;
            color: #333;
            font-size: 28px;
            text-align: center
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px
        }

        .score-display {
            text-align: center;
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1)
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px
        }

        button {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2)
        }

        button:active {
            transform: translateY(0)
        }

        .btn-music {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: #fff
        }

        .btn-shop {
            background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
            color: #fff
        }

        .btn-jump {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: #fff
        }

        .btn-coin {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: #fff
        }

        .btn-stop {
            background: #ff4757;
            color: #fff
        }

        .status {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 14px;
            color: #666
        }

        .status.playing {
            background: #e8f5e9;
            color: #2e7d32
        }

        .status.shop {
            background: #f3e5f5;
            color: #7b1fa2
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ðŸŽµ Web Audio Demo</h1>
        <div class="subtitle">Procedural music â€¢ Oscillator sound effects</div>
        <div class="score-display" id="score">Score: 0</div>
        <div class="btn-group">
            <button class="btn-music" onclick="toggleGameMusic()">Game Music ðŸŽ®</button>
            <button class="btn-shop" onclick="toggleShopMusic()">Shop Music ðŸ›’</button>
        </div>
        <div class="btn-group">
            <button class="btn-jump" onclick="playJump()">Jump ðŸš€</button>
            <button class="btn-coin" onclick="playCoin()">Coin ðŸ’°</button>
            <button class="btn-stop" onclick="playDamage()">Damage ðŸ’¥</button>
        </div>
        <div class="btn-group">
            <button class="btn-stop" onclick="stopAll()">Stop All</button>
        </div>
        <div class="status" id="status">Click a music button to start!</div>
    </div>
    <script>
        let ctx, score = 0;
        let gameNodes = [], shopNodes = [];
        let gamePlaying = false, shopPlaying = false;

        function initAudio() {
            if (!ctx) ctx = new (window.AudioContext || window.webkitAudioContext)();
            return ctx;
        }

        // Game music: energetic arpeggio loop
        function startGameMusic() {
            initAudio();
            stopGameMusic();

            const masterGain = ctx.createGain();
            masterGain.gain.value = 0.15;
            masterGain.connect(ctx.destination);
            gameNodes.push(masterGain);



            // Arpeggio sequence (Extend to 8 notes for 4/4 time)
            const notes = [220, 277, 330, 440, 554, 440, 330, 277]; // A3, C#4, E4, A4, C#5, A4, E4, C#4
            let noteTick = 0;

            function playArpNote() {
                if (!gamePlaying) return;

                // Determine measure (4 beats = 16 sixteenths)
                // Cycle: 0 -> -2 -> -4 -> -5 (semitones)
                const measure = Math.floor(noteTick / 16) % 4;
                let semitoneShift = 0;
                if (measure === 1) semitoneShift = -1; // G#
                if (measure === 2) semitoneShift = -3; // F#
                if (measure === 3) semitoneShift = -4; // F

                const multiplier = Math.pow(2, semitoneShift / 12);
                const noteIndex = noteTick % notes.length;
                const freq = notes[noteIndex] * multiplier;

                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'square';
                osc.frequency.value = freq;

                // slightly random detune for analog feel
                osc.detune.value = Math.random() * 10 - 5;

                gain.gain.setValueAtTime(0.15, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.12);

                osc.connect(gain);
                gain.connect(masterGain);
                osc.start();
                osc.stop(ctx.currentTime + 0.15);

                noteTick++;
                setTimeout(playArpNote, 130); // slightly faster bpm
            }

            gamePlaying = true;
            playArpNote();
            updateStatus('ðŸŽ® Game music playing', 'playing');
        }

        function stopGameMusic() {
            gamePlaying = false;
            gameNodes.forEach(n => { try { n.stop ? n.stop() : n.disconnect(); } catch (e) { } });
            gameNodes = [];
        }

        function toggleGameMusic() {
            initAudio();
            if (gamePlaying) {
                stopGameMusic();
                updateStatus('Game music stopped');
            } else {
                stopShopMusic();
                startGameMusic();
            }
        }

        // Shop music: calm ambient chords
        function startShopMusic() {
            initAudio();
            stopShopMusic();

            const masterGain = ctx.createGain();
            masterGain.gain.value = 0.12;
            masterGain.connect(ctx.destination);
            shopNodes.push(masterGain);

            // Soft pad chords
            const chords = [
                [261, 329, 392], // C major
                [293, 369, 440], // D major
                [246, 311, 369], // B minor
                [220, 277, 329]  // A minor
            ];
            let chordIndex = 0;

            function playChord() {
                if (!shopPlaying) return;
                const chord = chords[chordIndex];
                chord.forEach((freq, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = 'sine';
                    osc.frequency.value = freq;
                    gain.gain.setValueAtTime(0, ctx.currentTime);
                    gain.gain.linearRampToValueAtTime(0.15, ctx.currentTime + 0.3);
                    gain.gain.linearRampToValueAtTime(0, ctx.currentTime + 1.8);
                    osc.connect(gain);
                    gain.connect(masterGain);
                    osc.start();
                    osc.stop(ctx.currentTime + 2);
                });
                chordIndex = (chordIndex + 1) % chords.length;
                setTimeout(playChord, 2000);
            }

            shopPlaying = true;
            playChord();
            updateStatus('ðŸ›’ Shop music playing', 'shop');
        }

        function stopShopMusic() {
            shopPlaying = false;
            shopNodes.forEach(n => { try { n.stop ? n.stop() : n.disconnect(); } catch (e) { } });
            shopNodes = [];
        }

        function toggleShopMusic() {
            initAudio();
            if (shopPlaying) {
                stopShopMusic();
                updateStatus('Shop music stopped');
            } else {
                stopGameMusic();
                startShopMusic();
            }
        }

        // Jump sound - LOUD rising sweep
        function playJump() {
            initAudio();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.type = 'sine';
            gain.gain.value = 0.8; // Much louder!
            osc.frequency.setValueAtTime(150, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.15);
            gain.gain.setValueAtTime(0.8, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
            osc.start();
            osc.stop(ctx.currentTime + 0.2);
            updateStatus('ðŸš€ Jump!');
            setTimeout(() => {
                if (gamePlaying) updateStatus('ðŸŽ® Game music playing', 'playing');
                else if (shopPlaying) updateStatus('ðŸ›’ Shop music playing', 'shop');
                else updateStatus('Ready');
            }, 800);
        }

        // Coin sound - cheerful arpeggio
        function playCoin() {
            initAudio();
            const notes = [988, 1319, 1568, 2093];
            notes.forEach((freq, i) => {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.type = 'square';
                osc.frequency.value = freq;
                gain.gain.setValueAtTime(0.25, ctx.currentTime + i * 0.05);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + i * 0.05 + 0.1);
                osc.start(ctx.currentTime + i * 0.05);
                osc.stop(ctx.currentTime + i * 0.05 + 0.1);
            });
            score++;
            document.getElementById('score').textContent = 'Score: ' + score;
            updateStatus('ðŸ’° Coin collected! +1');
            setTimeout(() => {
                if (gamePlaying) updateStatus('ðŸŽ® Game music playing', 'playing');
                else if (shopPlaying) updateStatus('ðŸ›’ Shop music playing', 'shop');
                else updateStatus('Ready');
            }, 800);
        }

        // Damage sound - harsh distorted hit
        function playDamage() {
            initAudio();
            // Noise burst using oscillator
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            const distortion = ctx.createWaveShaper();

            // Create distortion curve
            const k = 50;
            const n_samples = 44100;
            const curve = new Float32Array(n_samples);
            for (let i = 0; i < n_samples; i++) {
                const x = i * 2 / n_samples - 1;
                curve[i] = (3 + k) * x * 20 / (Math.PI + k * Math.abs(x));
            }
            distortion.curve = curve;
            distortion.oversample = '4x';

            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(50, ctx.currentTime + 0.15);

            gain.gain.setValueAtTime(0.6, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);

            osc.connect(distortion);
            distortion.connect(gain);
            gain.connect(ctx.destination);

            osc.start();
            osc.stop(ctx.currentTime + 0.2);

            updateStatus('ðŸ’¥ Damage taken!');
            setTimeout(() => {
                if (gamePlaying) updateStatus('ðŸŽ® Game music playing', 'playing');
                else if (shopPlaying) updateStatus('ðŸ›’ Shop music playing', 'shop');
                else updateStatus('Ready');
            }, 800);
        }

        function stopAll() {
            stopGameMusic();
            stopShopMusic();
            updateStatus('All sounds stopped');
        }

        function updateStatus(text, cls = '') {
            const el = document.getElementById('status');
            el.textContent = text;
            el.className = 'status' + (cls ? ' ' + cls : '');
        }
    </script>
</body>

</html>