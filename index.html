<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Doobert</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0f0c29;
            color: var(--text-color);
            height: 100vh;
            width: 100vw;
        }

        canvas {
            display: block;
        }

        #c {
            z-index: 5;
            /* Game layer above background */
            position: absolute;
            top: 0;
            left: 0;
        }

        :root {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --neon-blue: #00f3ff;
            --neon-pink: #d400ff;
            --gold: #ffd700;
            --tartan-red: #cc0000;
            --tartan-green: #006600;
            --tech-blue: #00d4ff;
            --muted-gold: #d4af37;
        }

        /* this is for character selection */
        #character-selection {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 15;
            display: none;
            overflow-y: auto;
            background: rgb(15, 12, 41);
        }

        #character-selection.active {
            display: block;
        }

        #path-selection {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 15;
            display: none;
            overflow-y: auto;
            background: rgb(15, 12, 41);
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #path-selection.active {
            display: flex;
        }

        #path-selection h2 {
            color: #fff;
            font-size: 3rem;
            margin-bottom: 3rem;
            text-align: center;
        }

        .section {
            display: flex;
            gap: 60px;
            justify-content: center;
            align-items: center;
        }

        .btn {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: scale(1.1);
        }

        .path-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .path-label {
            color: #fff;
            font-size: 24px;
            font-weight: bold;
            margin: 0;
        }

        char-body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px;
            gap: 40px;
        }

        h2 {
            font-weight: 300;
            opacity: 0.7;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }

        .container {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .char-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 280px;
            background: #1a1a1a;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #333;
        }

        .char-btn {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            position: relative;
            background: #222;
            border: 4px solid #444;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s;
            cursor: pointer;
        }

        .char-btn:hover {
            transform: scale(1.05);
        }

        .char-name {
            font-size: 18px;
            font-weight: bold;
        }

        .char-desc {
            font-size: 12px;
            opacity: 0.6;
            text-align: center;
        }

        .char-stats {
            width: 100%;
            background: #0a0a0a;
            border-radius: 8px;
            padding: 12px;
            font-size: 11px;
            line-height: 1.6;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 4px 0;
        }

        .stat-label {
            opacity: 0.8;
        }

        .stat-value {
            font-weight: bold;
            color: #4a90e2;
        }

        .special-ability {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #333;
        }

        .ability-name {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 4px;
        }

        .ability-desc {
            font-size: 10px;
            opacity: 0.7;
            line-height: 1.4;
        }

        /* --- Scotty: Terrier, Tartan --- */
        .btn-scotty {
            background: #1a1a1a;
            border-color: #3a3a3a;
        }

        /* Plaid Background Effect */
        .scotty-bg {
            position: absolute;
            inset: 0;
            opacity: 0.3;
            background-image:
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(204, 0, 0, 0.2) 10px, rgba(204, 0, 0, 0.2) 20px),
                repeating-linear-gradient(-45deg, transparent, transparent 10px, rgba(0, 100, 0, 0.2) 10px, rgba(0, 100, 0, 0.2) 20px);
        }

        .scotty-svg {
            position: relative;
            width: 80%;
            height: 80%;
            top: 10%;
            left: 10%;
        }

        .terrier-head {
            fill: #1a1a1a;
            stroke: #333;
            stroke-width: 2;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
        }

        .terrier-body {
            fill: #0d0d0d;
            stroke: #2a2a2a;
            stroke-width: 1.5;
        }

        .shaggy-fur {
            stroke: #3a3a3a;
            stroke-width: 1.5;
            fill: none;
        }

        .bowtie {
            fill: url(#tartanGradient);
            stroke: #000;
            stroke-width: 1;
        }

        .tartan-coat {
            fill: url(#tartanGradient);
            opacity: 0.9;
        }

        .ear-highlight {
            fill: none;
            stroke: #444;
            stroke-width: 2;
        }

        .scotty-eye {
            fill: #000;
            stroke: #fff;
            stroke-width: 0.5;
        }

        .scotty-snout {
            fill: #2a2a2a;
        }

        .scotty-beard {
            fill: #1a1a1a;
            stroke: #3a3a3a;
            stroke-width: 1;
        }

        /* --- Husky: Neon, Sunglasses --- */
        .btn-husky {
            background: linear-gradient(135deg, #102030, #000);
            border-color: var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.3);
        }

        .husky-svg {
            position: relative;
            width: 90%;
            height: 90%;
            top: 5%;
            left: 5%;
        }

        .husky-fur {
            fill: #e0e0e0;
        }

        .husky-mask {
            fill: #304050;
        }

        .glasses-frame {
            fill: #111;
            stroke: var(--neon-pink);
            stroke-width: 1;
        }

        .glasses-lens {
            fill: url(#lensGradient);
            opacity: 0.8;
        }

        .crypto-glint {
            fill: #fff;
            opacity: 0.8;
            filter: drop-shadow(0 0 2px #fff);
        }

        /* --- Golden: Glasses, Charts --- */
        .btn-golden {
            background: #2a2010;
            border-color: var(--gold);
        }

        .chart-bg {
            position: absolute;
            inset: 0;
            opacity: 0.2;
            background-image: linear-gradient(0deg, transparent 95%, rgba(0, 255, 0, 0.5) 95%);
            background-size: 10px 10px;
        }

        .golden-chart-line {
            position: absolute;
            inset: 0;
            stroke: #00ff00;
            stroke-width: 2;
            fill: none;
            opacity: 0.3;
            transform: scaleY(0.5) translateY(30px);
        }

        .golden-svg {
            position: relative;
            width: 85%;
            height: 85%;
            top: 10%;
            left: 7.5%;
        }

        .golden-fur {
            fill: #d4af37;
            filter: drop-shadow(0 0 5px rgba(212, 175, 55, 0.4));
        }

        .golden-snoot {
            fill: #ffeebb;
        }

        .reading-glasses {
            fill: none;
            stroke: #000;
            stroke-width: 1.5;
        }

        .glass-lens-clear {
            fill: rgba(255, 255, 255, 0.2);
        }

        /* --- Corgi: Crown, Royal --- */
        .btn-corgi {
            background: #2a1505;
            border-color: #ff8800;
            box-shadow: 0 0 15px rgba(255, 136, 0, 0.3);
        }

        .corgi-svg {
            position: relative;
            width: 85%;
            height: 85%;
            top: 12%;
            left: 7.5%;
        }

        .corgi-fur-orange {
            fill: #d67828;
        }

        .corgi-fur-white {
            fill: #fff;
        }

        .crown {
            fill: var(--gold);
            stroke: #b8860b;
            stroke-width: 1;
            filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.5));
            transform-origin: 50% 10%;
            animation: crown-tilt 3s ease-in-out infinite alternate;
        }

        @keyframes crown-tilt {
            from {
                transform: rotate(-5deg);
            }

            to {
                transform: rotate(5deg);
            }
        }

        .gem {
            fill: #ff0000;
        }

        /* --- Shiba Inu: Safety Helmet, Shield --- */
        .btn-shiba {
            background: #2a1a10;
            border-color: #4488ff;
            box-shadow: 0 0 10px rgba(68, 136, 255, 0.4) inset;
        }

        .shiba-svg {
            position: relative;
            width: 90%;
            height: 90%;
            top: 10%;
            left: 5%;
        }

        .fur-orange {
            fill: #d4834f;
        }

        .fur-cream {
            fill: #f5deb3;
        }

        .helmet-yellow {
            fill: #ffcc00;
            stroke: #b8860b;
            stroke-width: 1;
        }

        .helmet-stripe {
            fill: #fff;
            opacity: 0.8;
        }

        .safety-shield-aura {
            position: absolute;
            inset: -5px;
            border-radius: 50%;
            border: 2px solid rgba(68, 136, 255, 0.5);
            box-shadow: 0 0 15px rgba(68, 136, 255, 0.3);
            animation: shield-pulse 3s infinite;
        }

        @keyframes shield-pulse {

            0%,
            100% {
                opacity: 0.5;
                transform: scale(1);
            }

            50% {
                opacity: 0.8;
                transform: scale(1.05);
            }
        }

        /* --- Pitbull: Hard Hat, Hustle --- */
        .btn-pitbull {
            background: #222222;
            border-color: #888;
        }

        .pitbull-svg {
            position: relative;
            width: 85%;
            height: 85%;
            top: 10%;
            left: 7.5%;
        }

        .fur-grey {
            fill: #777;
        }

        .fur-white-patch {
            fill: #ddd;
        }

        .hard-hat {
            fill: #ffaa00;
            stroke: #cc8800;
            stroke-width: 1;
        }

        .collar-blue {
            fill: #0044ff;
            stroke: #002288;
            stroke-width: 1;
        }

        .muscle-line {
            fill: none;
            stroke: #555;
            stroke-width: 1;
            opacity: 0.5;
        }

        .btn-tech {
            width: 150px;
            height: 130px;
            background: #000;
            border: 2px solid var(--tech-blue);
            clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 15px var(--tech-blue) inset;
            animation: flicker 4s infinite;
        }

        @keyframes flicker {
            0% {
                opacity: 1;
            }

            95% {
                opacity: 1;
            }

            96% {
                opacity: 0.8;
            }

            97% {
                opacity: 1;
            }

            98% {
                opacity: 0.9;
            }

            100% {
                opacity: 1;
            }
        }

        .btn-tech svg {
            width: 70px;
            height: 70px;
            stroke: var(--tech-blue);
            stroke-width: 2;
            fill: none;
        }

        /* Creative Path: Rounded, Paper texture, Ink splatters */
        .btn-creative {
            width: 150px;
            height: 130px;
            border-radius: 20px;
            background: linear-gradient(135deg, #fdfbf7 0%, #ffe4c4 100%);
            border: none;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .btn-creative::after {
            /* Splatter */
            content: '';
            position: absolute;
            top: -10px;
            right: -10px;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, #ff6b6b 0%, transparent 70%);
            opacity: 0.4;
            border-radius: 50%;
        }

        .icon-creative {
            font-size: 70px;
            filter: drop-shadow(1px 1px 0 rgba(0, 0, 0, 0.1));
        }

        /* Corporate Path: Square, briefcase, grid */
        .btn-corporate {
            width: 150px;
            height: 130px;
            border-radius: 2px;
            border: 2px solid #555;
            background: #2c2f33;
            background-image:
                linear-gradient(#ffffff03 1px, transparent 1px),
                linear-gradient(90deg, #ffffff03 1px, transparent 1px);
            background-size: 15px 15px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .icon-briefcase {
            width: 70px;
            height: 55px;
            background: #777;
            border-radius: 4px;
            position: relative;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .icon-briefcase::before {
            /* Handle */
            content: '';
            position: absolute;
            top: -10px;
            left: 22px;
            width: 26px;
            height: 10px;
            border: 3px solid #777;
            border-bottom: none;
            border-radius: 6px 6px 0 0;
        }

        .icon-briefcase::after {
            /* Lock */
            content: '';
            position: absolute;
            top: 10px;
            left: 28px;
            width: 14px;
            height: 14px;
            background: var(--muted-gold);
            border-radius: 2px;
        }

        /* --- Layers --- */
        .layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #sky-canvas {
            z-index: 0;
        }

        #stars-canvas {
            z-index: 1;
        }

        #aurora-canvas {
            z-index: 2;
            opacity: 0.8;
            mix-blend-mode: screen;
        }

        #city-canvas {
            z-index: 3;
        }

        #reflection-canvas {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 25%;
            /* Water occupies bottom 25% */
            z-index: 4;
            opacity: 0.8;
            /* Increased opacity */
            filter: blur(1px);
            /* Reduced blur */
            transform: scaleY(-1);
            /* Mirror effect */
            pointer-events: none;
            mix-blend-mode: lighten;
            /* Blend with dark water base */
        }

        #water-base {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 25%;
            background: linear-gradient(to bottom, #151530, #000);
            /* Lighter blue top */
            z-index: 3;
            /* Behind reflection */
        }

        #ui {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
            width: 100%;
        }

        h1 {
            color: #fff;
            font-size: 4rem;
            margin-bottom: 2rem;
            text-shadow: 4px 4px 0 #4a0080;
            image-rendering: pixelated;
            font-variant-caps: small-caps;
        }

        button {
            background: #006400;
            /* Dark Green */
            color: #fff;
            border: 4px solid #004d00;
            padding: 1.5rem 4rem;
            font-size: 2rem;
            font-family: inherit;
            cursor: pointer;
            box-shadow: 0 0 20px #00ff0066;
            transition: transform 0.1s;
            animation: pulse 2s infinite;
            text-transform: uppercase;
            font-weight: bold;
        }

        button:active {
            transform: scale(0.95);
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(0, 100, 0, 0.7);
                transform: scale(1);
            }

            50% {
                box-shadow: 0 0 0 20px rgba(0, 100, 0, 0);
                transform: scale(1.05);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(0, 100, 0, 0);
                transform: scale(1);
            }
        }

        /* Timer Display */
        .timer-display {
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 48px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            z-index: 100;
            display: none;
        }

        /* Shop/Skills UI */
        #shop-ui {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 10, 0.95);
            z-index: 200;
            display: none;
            flex-direction: column;
        }

        #shop-ui.active {
            display: flex;
        }

        #closeShop {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 15px 30px;
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            z-index: 201;
        }

        .tab-content {
            flex: 1;
            display: none;
            padding: 40px;
            overflow-y: auto;
        }

        .tab-content.active {
            display: block;
        }

        .nav-bar {
            display: flex;
            background: #1a1a2e;
            border-top: 2px solid #333;
        }

        .nav-tab {
            flex: 1;
            padding: 20px;
            font-size: 24px;
            font-weight: bold;
            background: #16213e;
            color: #888;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-tab.active {
            background: #0f3460;
            color: white;
            border-bottom: 4px solid #00d4ff;
        }

        #skills-canvas {
            width: 100%;
            height: 100%;
            min-height: 600px;
        }

        .shop-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            max-width: 800px;
            margin: 0 auto;
        }

        .shop-item {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: #555;
            border: 4px solid #888;
            cursor: pointer;
            transition: all 0.3s;
        }

        .shop-item:hover {
            background: #777;
            border-color: #aaa;
            transform: scale(1.1);
        }
    </style>
</head>

<body>
    <canvas id="c"></canvas>
    <div id="ui">
        <h1>DOOBERT</h1>
        <button id="playBtn">PLAY</button>
    </div>
    <div class="timer-display">15</div>

    <div id="shop-ui">
        <button id="closeShop">RESUME</button>
        <div id="skills-tab" class="tab-content active">
            <canvas id="skills-canvas"></canvas>
        </div>
        <div id="shop-tab" class="tab-content">
            <div class="shop-grid" id="shopGrid"></div>
        </div>
        <div class="nav-bar">
            <button class="nav-tab active" data-tab="skills">SKILLS</button>
            <button class="nav-tab" data-tab="shop">SHOP</button>
        </div>
    </div>
    
    <canvas id="sky-canvas" class="layer"></canvas>
    <canvas id="stars-canvas" class="layer"></canvas>
    <canvas id="aurora-canvas" class="layer"></canvas>

    <!-- Water Base -->
    <div id="water-base"></div>
    <!-- City sits above water -->
    <canvas id="city-canvas" class="layer"></canvas>
    <!-- Reflection is a copy of city/lights inverted -->
    <canvas id="reflection-canvas"></canvas>

    <!-- Character selection -->
    <div id="character-selection">
    <svg width="0" height="0">
        <defs>
            <linearGradient id="tartanGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#cc0000" />
                <stop offset="25%" stop-color="#006600" />
                <stop offset="50%" stop-color="#000066" />
                <stop offset="75%" stop-color="#ffff00" />
                <stop offset="100%" stop-color="#cc0000" />
            </linearGradient>
            <linearGradient id="lensGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stop-color="#00f3ff" />
                <stop offset="100%" stop-color="#d400ff" />
            </linearGradient>
        </defs>
    </svg>

    <h2>Character Selection</h2>
    <div class="container char-body">
        <!-- Scotty -->
        <div class="char-card">
            <div class="char-btn btn-scotty" title="Scotty" onclick="selectCharacter('scotty')">
                <div class="scotty-bg"></div>
                <svg class="scotty-svg" viewBox="0 0 100 100">
                    <!-- Body with Tartan Coat -->
                    <ellipse cx="50" cy="65" rx="22" ry="18" class="terrier-body" />
                    <rect x="28" y="50" width="44" height="25" class="tartan-coat" rx="3" />

                    <!-- Head (black, shaggy) -->
                    <ellipse cx="50" cy="42" rx="20" ry="22" class="terrier-head" />

                    <!-- Pointed Ears -->
                    <path d="M35 30 L 32 15 L 40 28 Z" class="terrier-head" />
                    <path d="M65 30 L 68 15 L 60 28 Z" class="terrier-head" />
                    <path d="M36 28 L 34 20 L 39 28 Z" class="ear-highlight" />
                    <path d="M64 28 L 66 20 L 61 28 Z" class="ear-highlight" />

                    <!-- Shaggy fur texture -->
                    <path d="M32 38 Q 28 42, 30 46" class="shaggy-fur" />
                    <path d="M68 38 Q 72 42, 70 46" class="shaggy-fur" />
                    <path d="M35 50 Q 32 54, 34 58" class="shaggy-fur" />
                    <path d="M65 50 Q 68 54, 66 58" class="shaggy-fur" />

                    <!-- Distinctive Beard (Scottish Terrier feature) -->
                    <ellipse cx="50" cy="56" rx="14" ry="10" class="scotty-beard" />
                    <path d="M40 58 Q 38 62, 40 64" class="shaggy-fur" />
                    <path d="M60 58 Q 62 62, 60 64" class="shaggy-fur" />

                    <!-- Snout -->
                    <ellipse cx="50" cy="52" rx="8" ry="6" class="scotty-snout" />

                    <!-- Eyes (bright for contrast) -->
                    <circle cx="43" cy="42" r="3" class="scotty-eye" />
                    <circle cx="57" cy="42" r="3" class="scotty-eye" />
                    <circle cx="43" cy="42" r="1.5" fill="#fff" />
                    <circle cx="57" cy="42" r="1.5" fill="#fff" />

                    <!-- Nose -->
                    <ellipse cx="50" cy="52" rx="3" ry="2.5" fill="#000" />
                </svg>
            </div>
            <div class="char-name">Scotty</div>
            <div class="char-desc">Thrifty, Steady, Risk-Averse</div>
            <div class="char-stats">
                <div class="stat-row"><span class="stat-label">üí∞ Income</span><span class="stat-value">95%</span></div>
                <div class="stat-row"><span class="stat-label">üõ°Ô∏è Defense</span><span class="stat-value">130%</span>
                </div>
                <div class="stat-row"><span class="stat-label">üìä Passive Income</span><span
                        class="stat-value">120%</span></div>
                <div class="special-ability">
                    <div class="ability-name">SCOTTISH SAVINGS</div>
                    <div class="ability-desc">‚Ä¢ Auto-banks 10% of year-end balance<br>‚Ä¢ Locked for 2 years, +15% passive
                        income<br>‚Ä¢ Early withdrawal burns 20%</div>
                </div>
            </div>
        </div>

        <!-- Husky -->
        <div class="char-card">
            <div class="char-btn btn-husky" title="Husky" onclick="selectCharacter('husky')">
                <svg class="husky-svg" viewBox="0 0 100 100">
                    <path class="husky-fur"
                        d="M20 40 L 30 10 L 40 30 L 60 30 L 70 10 L 80 40 L 85 70 Q 50 85, 15 70 Z" />
                    <path class="husky-mask" d="M20 40 L 40 30 L 50 50 L 60 30 L 80 40 L 75 60 Q 50 70, 25 60 Z" />
                    <path class="husky-fur" d="M40 30 L 50 50 L 60 30" /> <!-- Forehead blaze -->
                    <!-- Sunglasses -->
                    <path class="glasses-frame" d="M25 45 H 75 V 55 H 25 Z" />
                    <rect class="glasses-lens" x="27" y="47" width="20" height="6" />
                    <rect class="glasses-lens" x="53" y="47" width="20" height="6" />
                    <path d="M50 48 L 50 45" stroke="#111" stroke-width="2" /> <!-- Bridge -->
                    <path class="crypto-glint" d="M30 47 L 35 47 L 32 53 Z" /> <!-- Glint -->
                </svg>
            </div>
            <div class="char-name">Husky</div>
            <div class="char-desc">High Risk, Crypto Bro Energy</div>
            <div class="char-stats">
                <div class="stat-row"><span class="stat-label">üí∞ Income</span><span class="stat-value">140%</span>
                </div>
                <div class="stat-row"><span class="stat-label">üõ°Ô∏è Defense</span><span class="stat-value">65%</span>
                </div>
                <div class="stat-row"><span class="stat-label">üìä Passive Income</span><span
                        class="stat-value">75%</span></div>
                <div class="special-ability">
                    <div class="ability-name">MOON SHOT</div>
                    <div class="ability-desc">‚Ä¢ Coin value: $65‚Äì$160 (volatile)<br>‚Ä¢ Boom: +2√ó coin value<br>‚Ä¢ Crash:
                        ‚àí30% year-end balance<br>‚Ä¢ Consecutive crashes stack</div>
                </div>
            </div>
        </div>

        <!-- Golden -->
        <div class="char-card">
            <div class="char-btn btn-golden" title="Golden Retriever" onclick="selectCharacter('golden')">
                <div class="chart-bg"></div>
                <!-- Background Chart Line -->
                <svg class="golden-chart-line" viewBox="0 0 100 100" preserveAspectRatio="none">
                    <polyline points="0,80 20,70 40,75 60,50 80,40 100,20" />
                </svg>
                <svg class="golden-svg" viewBox="0 0 100 100">
                    <!-- Head -->
                    <ellipse cx="50" cy="45" rx="22" ry="25" class="golden-fur" />
                    <!-- Ears -->
                    <ellipse cx="30" cy="40" rx="8" ry="15" class="golden-fur" />
                    <ellipse cx="70" cy="40" rx="8" ry="15" class="golden-fur" />
                    <!-- Snout -->
                    <ellipse cx="50" cy="55" rx="12" ry="10" class="golden-snoot" />
                    <!-- Eyes -->
                    <circle cx="42" cy="42" r="3" fill="#000" />
                    <circle cx="58" cy="42" r="3" fill="#000" />
                    <!-- Nose -->
                    <circle cx="50" cy="55" r="3" fill="#000" />
                    <!-- Reading Glasses -->
                    <circle class="glass-lens-clear" cx="42" cy="42" r="6" stroke="#000" stroke-width="1.5"
                        fill="rgba(255,255,255,0.2)" />
                    <circle class="glass-lens-clear" cx="58" cy="42" r="6" stroke="#000" stroke-width="1.5"
                        fill="rgba(255,255,255,0.2)" />
                    <line x1="48" y1="42" x2="52" y2="42" stroke="#000" stroke-width="1.5" />
                </svg>
            </div>
            <div class="char-name">Golden Retriever</div>
            <div class="char-desc">Patient, Compound Interest</div>
            <div class="char-stats">
                <div class="stat-row"><span class="stat-label">üí∞ Income</span><span class="stat-value">75%</span></div>
                <div class="stat-row"><span class="stat-label">üõ°Ô∏è Defense</span><span class="stat-value">95%</span>
                </div>
                <div class="stat-row"><span class="stat-label">üìä Passive Income</span><span
                        class="stat-value">165%</span></div>
                <div class="special-ability">
                    <div class="ability-name">COMPOUND MAGIC</div>
                    <div class="ability-desc">‚Ä¢ Year-end balance +10% growth<br>‚Ä¢ Passive skills unlock 1 year
                        early<br>‚Ä¢ 70% balance locked each year</div>
                </div>
            </div>
        </div>

        <!-- Corgi -->
        <div class="char-card">
            <div class="char-btn btn-corgi" title="Corgi" onclick="selectCharacter('corgi')">
                <svg class="corgi-svg" viewBox="0 0 100 100">
                    <!-- Head -->
                    <ellipse cx="50" cy="50" rx="20" ry="22" class="corgi-fur-orange" />
                    <!-- Ears -->
                    <ellipse cx="35" cy="35" rx="7" ry="12" class="corgi-fur-orange" />
                    <ellipse cx="65" cy="35" rx="7" ry="12" class="corgi-fur-orange" />
                    <!-- White Blaze -->
                    <ellipse cx="50" cy="50" rx="8" ry="15" class="corgi-fur-white" />
                    <!-- Eyes (properly centered) -->
                    <circle cx="42" cy="47" r="3" fill="#000" />
                    <circle cx="58" cy="47" r="3" fill="#000" />
                    <!-- Nose -->
                    <circle cx="50" cy="58" r="3" fill="#000" />
                    <!-- Smile -->
                    <path d="M45 62 Q 50 65, 55 62" fill="none" stroke="#000" stroke-width="1.5" />
                    <!-- Crown -->
                    <g class="crown">
                        <path d="M35 28 L 38 20 L 43 25 L 50 18 L 57 25 L 62 20 L 65 28 L 35 28 Z" />
                        <circle class="gem" cx="50" cy="24" r="2" />
                    </g>
                </svg>
            </div>
            <div class="char-name">Corgi</div>
            <div class="char-desc">Royalty, Born with Advantages</div>
            <div class="char-stats">
                <div class="stat-row"><span class="stat-label">üí∞ Income</span><span class="stat-value">120%</span>
                </div>
                <div class="stat-row"><span class="stat-label">üõ°Ô∏è Defense</span><span class="stat-value">110%</span>
                </div>
                <div class="stat-row"><span class="stat-label">üìä Passive Income</span><span
                        class="stat-value">135%</span></div>
                <div class="special-ability">
                    <div class="ability-name">INHERITANCE</div>
                    <div class="ability-desc">‚Ä¢ Starts Year 1 with 500 coins ($50K)<br>‚Ä¢ Random windfalls (+100‚Äì300
                        coins)<br>‚Ä¢ Skill costs +15% yearly<br>‚Ä¢ Lifestyle siphons 5% balance yearly</div>
                </div>
            </div>
        </div>

        <!-- Shiba Inu -->
        <div class="char-card">
            <div class="char-btn btn-shiba" title="Shiba Inu" onclick="selectCharacter('shiba')">
                <div class="safety-shield-aura"></div>
                <svg class="shiba-svg" viewBox="0 0 100 100">
                    <!-- Head (round, fox-like) -->
                    <ellipse cx="50" cy="50" rx="22" ry="24" class="fur-orange" />

                    <!-- Pointed Ears (characteristic feature) -->
                    <path d="M35 35 L 30 20 L 40 30 Z" class="fur-orange" />
                    <path d="M65 35 L 70 20 L 60 30 Z" class="fur-orange" />
                    <!-- Ear inner (cream) -->
                    <path d="M35 32 L 32 22 L 38 30 Z" class="fur-cream" />
                    <path d="M65 32 L 68 22 L 62 30 Z" class="fur-cream" />

                    <!-- Cream cheeks/muzzle area -->
                    <ellipse cx="50" cy="58" rx="14" ry="10" class="fur-cream" />

                    <!-- Eyes (small, alert) -->
                    <ellipse cx="42" cy="48" rx="3" ry="4" fill="#000" />
                    <ellipse cx="58" cy="48" rx="3" ry="4" fill="#000" />

                    <!-- Nose -->
                    <circle cx="50" cy="60" r="3" fill="#000" />

                    <!-- Smile (characteristic Shiba smile) -->
                    <path d="M42 64 Q 50 68, 58 64" fill="none" stroke="#000" stroke-width="1.5" />

                    <!-- Safety Helmet -->
                    <ellipse cx="50" cy="28" rx="18" ry="10" class="helmet-yellow" />
                    <rect x="32" y="34" width="36" height="4" class="helmet-yellow" rx="2" />
                    <rect x="49" y="22" width="2" height="10" class="helmet-stripe" />
                </svg>
            </div>
            <div class="char-name">Shiba Inu</div>
            <div class="char-desc">Cautious, Emergency Fund</div>
            <div class="char-stats">
                <div class="stat-row"><span class="stat-label">üí∞ Income</span><span class="stat-value">85%</span></div>
                <div class="stat-row"><span class="stat-label">üõ°Ô∏è Defense</span><span class="stat-value">150%</span>
                </div>
                <div class="stat-row"><span class="stat-label">üìä Passive Income</span><span
                        class="stat-value">95%</span></div>
                <div class="special-ability">
                    <div class="ability-name">SELF-PRESERVATION INSTINCT</div>
                    <div class="ability-desc">‚Ä¢ Starts with 3 Guard Tokens yearly<br>‚Ä¢ Tokens negate
                        obstacles/events<br>‚Ä¢ Debt/penalties reduced 40%<br>‚Ä¢ Skill costs +10%, no high-risk bonuses
                    </div>
                </div>
            </div>
        </div>

        <!-- Pitbull -->
        <div class="char-card">
            <div class="char-btn btn-pitbull" title="Pitbull" onclick="selectCharacter('pitbull')">
                <svg class="pitbull-svg" viewBox="0 0 100 100">
                    <!-- Head (wide and muscular) -->
                    <ellipse cx="50" cy="50" rx="25" ry="22" class="fur-grey" />
                    <!-- Ears (small, folded) -->
                    <ellipse cx="32" cy="38" rx="6" ry="8" class="fur-grey" />
                    <ellipse cx="68" cy="38" rx="6" ry="8" class="fur-grey" />
                    <!-- White chest patch -->
                    <ellipse cx="50" cy="65" rx="10" ry="8" class="fur-white-patch" />
                    <!-- Eyes -->
                    <circle cx="42" cy="48" r="3" fill="#000" />
                    <circle cx="58" cy="48" r="3" fill="#000" />
                    <!-- Nose -->
                    <ellipse cx="50" cy="58" rx="4" ry="3" fill="#000" />
                    <!-- Mouth -->
                    <path d="M45 60 L 50 62 L 55 60" fill="none" stroke="#000" stroke-width="2" />
                    <!-- Hard Hat -->
                    <ellipse cx="50" cy="32" rx="22" ry="10" class="hard-hat" />
                    <rect x="28" y="38" width="44" height="4" class="hard-hat" rx="1" />
                    <!-- Collar -->
                    <ellipse cx="50" cy="68" rx="18" ry="5" class="collar-blue" />
                    <circle cx="50" cy="68" r="3" fill="#ffd700" />
                </svg>
            </div>
            <div class="char-name">Pitbull</div>
            <div class="char-desc">Pure Hustle, No Shortcuts</div>
            <div class="char-stats">
                <div class="stat-row"><span class="stat-label">üí∞ Income</span><span class="stat-value">105%</span>
                </div>
                <div class="stat-row"><span class="stat-label">üõ°Ô∏è Defense</span><span class="stat-value">90%</span>
                </div>
                <div class="stat-row"><span class="stat-label">üìä Passive Income</span><span
                        class="stat-value">65%</span></div>
                <div class="special-ability">
                    <div class="ability-name">OVERTIME GRIND</div>
                    <div class="ability-desc">‚Ä¢ Active collection +25% coin value<br>‚Ä¢ High combos boost income
                        permanently<br>‚Ä¢ Missed runs reduce combo bonuses<br>‚Ä¢ No passive scaling bonuses</div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- Path selection -->
    <div id="path-selection">
        <h2>Choose Your Path</h2>
        <div class="section">
            <div class="path-option">
                <div class="btn btn-tech" title="Tech Path" onclick="selectPath('tech')">
                    <svg viewBox="0 0 24 24">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />
                        <path d="M2 10h4v4h-4z" opacity="0.5" />
                    </svg>
                </div>
                <p class="path-label">Tech</p>
            </div>

            <div class="path-option">
                <div class="btn btn-creative" title="Creative Path" onclick="selectPath('creative')">
                    <div class="icon-creative">üé®</div>
                </div>
                <p class="path-label">Creative</p>
            </div>

            <div class="path-option">
                <div class="btn btn-corporate" title="Corporate Path" onclick="selectPath('corporate')">
                    <div class="icon-briefcase"></div>
                </div>
                <p class="path-label">Corporate</p>
            </div>
        </div>
    </div>

    <script>
        const c = document.getElementById('c');
        const ctx = c.getContext('2d');
        const ui = document.getElementById('ui');

        const staticCityCvs = document.createElement('canvas');
        const staticCityCtx = staticCityCvs.getContext('2d');

        let w, h;

        // Game State
        let gameState = 'TITLE'; // TITLE, CHARACTERS, PATHS, PLAYING, GAMEOVER, SHOP
        let gameTime = 0;
        let score = 0;
        let gameTimer = 0;
        const GAME_INTERVAL = 15; // 15 seconds

        // Player Class Stats
        let playerClass = null;
        let income = 1.0;
        let defense = 1.0;
        let passiveIncome = 1.0;

        // Player Path
        let playerPath = null;

        // Player
        const player = {
            x: 50,
            y: 0,
            size: 30,
            vy: 0,
            gravity: 0.2,
            thrust: -0.3,
            maxVy: 12,
            isThrusting: false,
            health: 100,
            maxHealth: 100,
            money: 0,
            character: null
        };

        // Entities
        let obstacles = [];
        let coins = [];
        let obstacleTimer = 0;
        let coinTimer = 0;

        // Resize function consolidated below
        // window.addEventListener('resize', resize);
        // resize();

        // Input Handling
        function startThrust(e) {
            if (e.type === 'mousedown' || e.type === 'touchstart') {
                player.isThrusting = true;
                if (gameState === 'GAMEOVER') resetGame();
            }
        }

        function endThrust(e) {
            if (e.type === 'mouseup' || e.type === 'touchend') {
                player.isThrusting = false;
            }
        }

        window.addEventListener('mousedown', startThrust);
        window.addEventListener('touchstart', startThrust);
        window.addEventListener('mouseup', endThrust);
        window.addEventListener('touchend', endThrust);

        document.getElementById('playBtn').addEventListener('click', (e) => {
            e.stopPropagation();
            showCharacterSelection();
        });

        function showCharacterSelection() {
            gameState = 'CHARACTERS';
            ui.style.display = 'none';
            document.querySelector('.timer-display').style.display = 'none';
            document.getElementById('character-selection').classList.add('active');
        }

        function selectCharacter(characterType) {
            // Store selected character
            player.character = characterType;
            playerClass = characterType;

            // Set stats based on character
            switch(characterType) {
                case 'scotty':
                    income = 0.95;
                    defense = 1.30;
                    passiveIncome = 1.20;
                    break;
                case 'husky':
                    income = 1.40;
                    defense = 0.65;
                    passiveIncome = 0.75;
                    break;
                case 'golden':
                    income = 0.75;
                    defense = 0.95;
                    passiveIncome = 1.65;
                    break;
                case 'corgi':
                    income = 1.20;
                    defense = 1.10;
                    passiveIncome = 1.35;
                    break;
                case 'shiba':
                    income = 0.85;
                    defense = 1.50;
                    passiveIncome = 0.95;
                    break;
                case 'pitbull':
                    income = 1.05;
                    defense = 0.90;
                    passiveIncome = 0.65;
                    break;
            }

            document.getElementById('character-selection').classList.remove('active');
            showPathSelection();
        }

        function showPathSelection() {
            gameState = 'PATHS';
            ui.style.display = 'none';
            document.querySelector('.timer-display').style.display = 'none';
            const pathDiv = document.getElementById('path-selection');
            pathDiv.classList.add('active');
        }

        function selectPath(pathType) {
            playerPath = pathType;
            document.getElementById('path-selection').classList.remove('active');
            initializeGame();
            startRunner();
        }

        function initializeGame() {
            player.y = h / 2;
            player.vy = 0;
            player.isThrusting = false;
            player.health = 100;
            player.money = 0;
            obstacles = [];
            coins = [];
            score = 0;
            gameTimer = 0;
        }

        function startRunner() {
            gameState = 'PLAYING';
            ui.style.display = 'none';
            document.querySelector('.timer-display').style.display = 'block';
        }

        function resetGame() {
            gameState = 'TITLE';
            ui.style.display = 'block';
            document.querySelector('.timer-display').style.display = 'none';
            document.getElementById('shop-ui').classList.remove('active');
            document.getElementById('character-selection').classList.remove('active');
            document.getElementById('path-selection').classList.remove('active');
        }

        // Initialize Shop Grid
        function initShopGrid() {
            const shopGrid = document.getElementById('shopGrid');
            shopGrid.innerHTML = '';
            for (let i = 0; i < 18; i++) {
                const item = document.createElement('button');
                item.className = 'shop-item';
                shopGrid.appendChild(item);
            }
        }

        // Draw Skills Tree
        function drawSkillsTree() {
            const canvas = document.getElementById('skills-canvas');
            const ctx = canvas.getContext('2d');
            const parent = canvas.parentElement;
            canvas.width = parent.clientWidth;
            canvas.height = parent.clientHeight;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Display selected path at the top
            if (playerPath) {
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 32px Arial';
                ctx.textAlign = 'center';
                const pathName = playerPath.charAt(0).toUpperCase() + playerPath.slice(1);
                ctx.fillText(`${pathName} Path`, canvas.width / 2, 50);
            }

            const layers = [1, 2, 4, 8];
            const nodeRadius = 30;
            const layerHeight = (canvas.height - 80) / (layers.length + 1);
            const nodes = [];

            ctx.strokeStyle = '#aaa';
            ctx.lineWidth = 2;

            for (let layer = 0; layer < layers.length; layer++) {
                const nodeCount = layers[layer];
                const spacing = canvas.width / (nodeCount + 1);
                for (let i = 0; i < nodeCount; i++) {
                    const x = spacing * (i + 1);
                    const y = 80 + layerHeight * (layer + 1);
                    nodes.push({ x, y, layer, index: i });

                    if (layer < layers.length - 1) {
                        const childLayer = layer + 1;
                        const childSpacing = canvas.width / (layers[childLayer] + 1);
                        for (let c = 0; c < 2; c++) {
                            const childIndex = i * 2 + c;
                            const childX = childSpacing * (childIndex + 1);
                            const childY = 80 + layerHeight * (childLayer + 1);
                            ctx.beginPath();
                            ctx.moveTo(x, y);
                            ctx.lineTo(childX, childY);
                            ctx.stroke();
                        }
                    }
                }
            }

            nodes.forEach(node => {
                ctx.fillStyle = '#ddd';
                ctx.beginPath();
                ctx.arc(node.x, node.y, nodeRadius, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#777';
                ctx.beginPath();
                ctx.arc(node.x, node.y, nodeRadius - 4, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // UI Event Listeners
        document.getElementById('closeShop').addEventListener('click', () => {
            document.getElementById('shop-ui').classList.remove('active');
            gameTimer = 0;
            startRunner();
        });

        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                tab.classList.add('active');
                document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');

                if (tab.dataset.tab === 'skills') drawSkillsTree();
            });
        });

        initShopGrid();

        // --- Configuration ---
        const config = {
            cycleDuration: 120000,
            waterLevel: 0.75 // Water starts at 75% height
        };

        let startTime = null;

        const skyCvs = document.getElementById('sky-canvas');
        const auroraCvs = document.getElementById('aurora-canvas');
        const starsCvs = document.getElementById('stars-canvas');
        const cityCvs = document.getElementById('city-canvas');
        const reflectCvs = document.getElementById('reflection-canvas');

        const skyCtx = skyCvs.getContext('2d');
        const auroraCtx = auroraCvs.getContext('2d');
        const starsCtx = starsCvs.getContext('2d');
        const cityCtx = cityCvs.getContext('2d');
        const reflectCtx = reflectCvs.getContext('2d');

        function resize() {
            w = c.width = window.innerWidth;
            h = c.height = window.innerHeight;

            [skyCvs, auroraCvs, starsCvs, cityCvs, reflectCvs].forEach(c => {
                c.width = window.innerWidth;
                c.height = window.innerHeight;
            });

            if (gameState === 'TITLE') player.y = h / 2;

            initStars();
            initCity();
            drawStaticCity(); // Call after initCity to draw buildings
        }
        window.addEventListener('resize', resize);

        // --- VIBRANT NYC SUNSET GRADIENTS ---
        const skyColors = [
            { pos: 0.0, stops: [{ r: 44, g: 62, b: 80 }, { r: 255, g: 94, b: 77 }] }, // Integrated some reds/oranges from image
            { pos: 0.15, stops: [{ r: 50, g: 40, b: 70 }, { r: 214, g: 50, b: 48 }] }, // Deep Red/Purple
            { pos: 0.3, stops: [{ r: 30, g: 30, b: 60 }, { r: 150, g: 50, b: 150 }] },
            { pos: 0.45, stops: [{ r: 10, g: 10, b: 35 }, { r: 60, g: 30, b: 80 }] },
            { pos: 0.6, stops: [{ r: 2, g: 2, b: 10 }, { r: 20, g: 20, b: 40 }] },
            { pos: 0.85, stops: [{ r: 20, g: 20, b: 40 }, { r: 70, g: 70, b: 100 }] },
            { pos: 1.0, stops: [{ r: 64, g: 64, b: 92 }, { r: 138, g: 118, b: 171 }] }
        ];

        function lerp(a, b, t) { return a + (b - a) * t; }
        function getInterpColor(c1, c2, t) {
            return `rgb(${lerp(c1.r, c2.r, t)}, ${lerp(c1.g, c2.g, t)}, ${lerp(c1.b, c2.b, t)})`;
        }

        function drawSky(progress) {
            let start = skyColors[0];
            let end = skyColors[skyColors.length - 1];

            for (let i = 0; i < skyColors.length - 1; i++) {
                if (progress >= skyColors[i].pos && progress < skyColors[i + 1].pos) {
                    start = skyColors[i];
                    end = skyColors[i + 1];
                    break;
                }
            }

            const range = end.pos - start.pos;
            const t = (progress - start.pos) / range;

            const c1 = getInterpColor(start.stops[0], end.stops[0], t);
            const c2 = getInterpColor(start.stops[1], end.stops[1], t);

            const grd = skyCtx.createLinearGradient(0, 0, 0, skyCvs.height * config.waterLevel);
            grd.addColorStop(0, c1);
            grd.addColorStop(1, c2);
            skyCtx.fillStyle = grd;
            skyCtx.fillRect(0, 0, skyCvs.width, skyCvs.height * config.waterLevel);
        }

        // --- Stars ---
        let bgStars = [];
        function initStars() {
            bgStars = [];
            for (let i = 0; i < 300; i++) {
                const isShiny = Math.random() < 0.1;
                bgStars.push({
                    x: Math.random() * window.innerWidth,
                    y: Math.random() * (window.innerHeight * config.waterLevel),
                    size: isShiny ? Math.random() * 2 + 1 : Math.random() * 1.5,
                    opacity: Math.random(),
                    twinkleSpeed: (Math.random() * 0.05 + 0.01) * (isShiny ? 2000 : 1),
                    isShiny: isShiny
                });
            }
        }

        function drawStars() {
            starsCtx.clearRect(0, 0, starsCvs.width, starsCvs.height);
            bgStars.forEach(s => {
                s.opacity += 0.005;
                const val = Math.abs(Math.sin(performance.now() * 0.001 * s.twinkleSpeed + s.x));

                starsCtx.shadowBlur = s.isShiny ? 8 : 0;
                starsCtx.shadowColor = 'white';
                starsCtx.fillStyle = `rgba(255, 255, 255, ${val})`;
                starsCtx.beginPath();
                starsCtx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
                starsCtx.fill();
            });
            starsCtx.shadowBlur = 0;
        }

        // --- City & Traffic ---
        let buildings = [];
        let cars = [];

        function initCity() {
            buildings = [];
            let currentX = 0;
            const groundY = window.innerHeight * config.waterLevel;

            while (currentX < window.innerWidth) {
                let width, height, shape = 'flattop';
                const rand = Math.random();

                // Varied Shapes inspired by NY
                if (rand > 0.85) { shape = 'empire'; width = 80; height = 400 + Math.random() * 100; } // Empire State
                else { shape = 'block'; width = 50 + Math.random() * 80; height = 150 + Math.random() * 300; }

                if (currentX + width > window.innerWidth) width = window.innerWidth - currentX;
                if (width < 20) break;

                // Windows
                const winW = 6, winH = 9, gapX = 4, gapY = 6;
                const cols = Math.floor((width - 4) / (winW + gapX));
                const rows = Math.floor((height - 10) / (winH + gapY));
                const winArr = [];

                for (let r = 0; r < rows; r++) {
                    for (let c = 0; c < cols; c++) {
                        let isOn = Math.random() > 0.5;

                        if (Math.random() > 0.3) {
                            winArr.push({ x: 4 + c * (winW + gapX), y: 10 + r * (winH + gapY), w: winW, h: winH, on: isOn, flickerOffset: Math.random() * 10000 });
                        }
                    }
                }

                buildings.push({ x: currentX, y: groundY - height, w: width, h: height, shape: shape, windows: winArr, colorIdx: Math.random() });
                currentX += width - 2;
            }

            // Init Cars
            cars = [];
            for (let i = 0; i < 40; i++) {
                cars.push({
                    x: Math.random() * window.innerWidth,
                    y: groundY - Math.random() * 5, // Just above water line
                    speed: Math.random() + 0.5,
                    dir: Math.random() > 0.5 ? 1 : -1,
                    color: Math.random() > 0.5 ? '#ff4444' : '#ffffff' // Tail vs Headlights
                });
            }
        }

        function drawStaticCity() {
            staticCityCvs.width = window.innerWidth;
            staticCityCvs.height = window.innerHeight;
            staticCityCtx.clearRect(0, 0, staticCityCvs.width, staticCityCvs.height);

            buildings.forEach(b => {
                const hue = 220 + b.colorIdx * 40;
                const grad = staticCityCtx.createLinearGradient(b.x, b.y, b.x, b.y + b.h);
                grad.addColorStop(0, `hsl(${hue}, 30%, 20%)`);
                grad.addColorStop(1, `hsl(${hue}, 40%, 5%)`);
                staticCityCtx.fillStyle = grad;

                staticCityCtx.beginPath();
                if (b.shape === 'empire') {
                    staticCityCtx.rect(b.x, b.y + 80, b.w, b.h - 80);
                    staticCityCtx.rect(b.x + b.w * 0.15, b.y + 40, b.w * 0.7, 40);
                    staticCityCtx.rect(b.x + b.w * 0.35, b.y, b.w * 0.3, 40);
                    staticCityCtx.rect(b.x + b.w / 2 - 2, b.y - 30, 4, 30);
                } else {
                    staticCityCtx.rect(b.x, b.y, b.w, b.h);
                }
                staticCityCtx.fill();
            });
        }

        function drawCity() {
            cityCtx.clearRect(0, 0, cityCvs.width, cityCvs.height);
            reflectCtx.clearRect(0, 0, reflectCvs.width, reflectCvs.height);

            // Draw cached buildings
            cityCtx.drawImage(staticCityCvs, 0, 0);

            const groundY = window.innerHeight * config.waterLevel;

            buildings.forEach(b => {
                // Windows (Dynamic)
                b.windows.forEach(win => {
                    if (!win.on) return;
                    let alpha = Math.abs(Math.sin((performance.now() + win.flickerOffset) * 0.002)) * 0.5 + 0.3;
                    cityCtx.globalAlpha = alpha;
                    cityCtx.fillStyle = '#ffebcc';
                    cityCtx.fillRect(b.x + win.x, b.y + win.y, win.w, win.h);
                });
                cityCtx.globalAlpha = 1;
            });

            // Street Lamps & Roads (Partially static, but keep for now or move to static)
            cityCtx.fillStyle = '#000';
            cityCtx.fillRect(0, groundY - 5, window.innerWidth, 5);

            for (let x = 20; x < window.innerWidth; x += 100) {
                cityCtx.fillStyle = '#444';
                cityCtx.fillRect(x, groundY - 40, 3, 40);
                cityCtx.fillStyle = '#ffaa00';
                cityCtx.shadowBlur = 10;
                cityCtx.shadowColor = '#ffaa00';
                cityCtx.beginPath();
                cityCtx.arc(x + 1.5, groundY - 42, 4, 0, Math.PI * 2);
                cityCtx.fill();
                cityCtx.shadowBlur = 0;
            }

            // Traffic
            cars.forEach(car => {
                car.x += car.speed * car.dir;
                if (car.x > window.innerWidth) car.x = -20;
                if (car.x < -20) car.x = window.innerWidth;

                cityCtx.fillStyle = car.color;
                cityCtx.shadowBlur = 5;
                cityCtx.shadowColor = car.color;
                cityCtx.fillRect(car.x, car.y, 8, 3);
                cityCtx.shadowBlur = 0;
            });

            // Capture City for Reflection
            // We just draw the city canvas onto the reflection canvas
            // Use drawImage
            reflectCtx.drawImage(cityCvs, 0, 0);
        }

        // --- Aurora & Meteors ---
        let auroraTime = 0;
        function drawAurora() {
            auroraCtx.clearRect(0, 0, auroraCvs.width, auroraCvs.height);
            auroraTime += 0.002;
            const bands = 2;
            for (let i = 0; i < bands; i++) {
                auroraCtx.beginPath();
                const baseY = 150 + i * 80;
                for (let x = 0; x <= auroraCvs.width; x += 15) {
                    const noise = Math.sin(x * 0.001 + auroraTime) * 1.2 + Math.sin(x * 0.003 - auroraTime) * 0.5;
                    const y = baseY + noise * 40;
                    if (x === 0) auroraCtx.moveTo(x, y); else auroraCtx.lineTo(x, y);
                }
                auroraCtx.lineTo(auroraCvs.width, 0); auroraCtx.lineTo(0, 0); auroraCtx.closePath();
                const grad = auroraCtx.createLinearGradient(0, 0, 0, auroraCvs.height / 2);
                grad.addColorStop(0, 'rgba(0, 255, 128, 0)'); grad.addColorStop(1, 'rgba(0, 255, 128, 0.2)');
                auroraCtx.fillStyle = grad; auroraCtx.filter = 'blur(20px)'; auroraCtx.fill(); auroraCtx.filter = 'none';
            }
        }

        class Meteor {
            constructor() { this.reset(); }
            reset() { this.active = false; this.spawnTime = performance.now() + Math.random() * 10000 + 2000; this.speed = 15; }
            activate() { this.active = true; this.x = Math.random() * window.innerWidth; this.y = Math.random() * window.innerHeight * 0.3; this.size = Math.random() * 2 + 1; const angle = Math.PI / 4 + (Math.random() - 0.5); this.vx = Math.cos(angle) * this.speed; this.vy = Math.sin(angle) * this.speed; this.alpha = 1; }
            update() { if (!this.active) { if (performance.now() > this.spawnTime) this.activate(); return; } this.x += this.vx; this.y += this.vy; this.alpha -= 0.05; if (this.alpha <= 0) this.reset(); }
            draw() { if (!this.active || this.alpha <= 0) return; starsCtx.strokeStyle = `rgba(255,255,255,${this.alpha})`; starsCtx.lineWidth = this.size; starsCtx.beginPath(); starsCtx.moveTo(this.x, this.y); starsCtx.lineTo(this.x - this.vx * 2, this.y - this.vy * 2); starsCtx.stroke(); }
        }
        const meteors = [new Meteor(), new Meteor()];

        function frame(timestamp) {
            if (!startTime) startTime = timestamp;
            const elapsed = timestamp - startTime;
            const progress = (elapsed % config.cycleDuration) / config.cycleDuration;

            drawSky(progress);
            drawCity(); // Handles reflection & traffic
            drawStars();
            meteors.forEach(m => { m.update(); m.draw(); });
            drawAurora();

            requestAnimationFrame(frame);
        }

        resize();
        requestAnimationFrame(frame);

        // Obstacle Class
        class Obstacle {
            constructor() {
                // Type: 0 = floating block, 1 = top wall, 2 = bottom wall
                this.type = Math.floor(Math.random() * 3);
                this.w = 50 + Math.random() * 30;
                this.x = w;
                this.color = '#ff4444';
                this.markedForDeletion = false;

                if (this.type === 0) { // Block
                    this.h = 40 + Math.random() * 40;
                    this.y = Math.random() * (h - this.h);
                } else if (this.type === 1) { // Top Wall
                    this.h = h * 0.2 + Math.random() * (h * 0.4); // 20-60% height
                    this.y = 0;
                } else { // Bottom Wall
                    this.h = h * 0.2 + Math.random() * (h * 0.4);
                    this.y = h - this.h;
                }
            }
            update() {
                this.x -= 3; // Speed
                if (this.x + this.w < 0) this.markedForDeletion = true;
            }
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.w, this.h);
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.strokeRect(this.x, this.y, this.w, this.h);
            }
        }

        // Coin Class
        class Coin {
            constructor() {
                this.size = 15;
                this.x = w;
                this.y = 50 + Math.random() * (h - 100);
                this.markedForDeletion = false;
                this.waffleOffset = Math.random() * 100;
            }
            update() {
                this.x -= 6;
                this.waffleOffset += 0.1;
                this.y += Math.sin(this.waffleOffset) * 0.5;
                if (this.x + this.size < 0) this.markedForDeletion = true;
            }
            draw() {
                ctx.save();
                ctx.translate(this.x + this.size, this.y + this.size);

                // Outer Gold
                ctx.beginPath();
                ctx.arc(0, 0, this.size, 0, Math.PI * 2);
                ctx.fillStyle = '#FFD700';
                ctx.fill();
                ctx.strokeStyle = '#DAA520';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Shine
                ctx.beginPath();
                ctx.arc(-4, -4, this.size * 0.3, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.fill();

                // Inner Symbol
                ctx.fillStyle = '#DAA520';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('$', 0, 1);

                ctx.restore();
            }
        }

        // UI Drawing
        function drawUI() {
            const padding = 20;
            const barHeight = 20;
            const barWidth = 200;

            // Health Bar
            ctx.save();
            ctx.translate(padding, padding);

            // Heart Icon
            ctx.fillStyle = '#ff0000';
            ctx.beginPath();
            ctx.moveTo(10, 10);
            ctx.bezierCurveTo(10, 3, 5, 0, 0, 0);
            ctx.bezierCurveTo(-5, 0, -10, 3, -10, 10);
            ctx.bezierCurveTo(-10, 20, 0, 30, 10, 40);
            ctx.bezierCurveTo(20, 30, 30, 20, 30, 10);
            ctx.bezierCurveTo(30, 3, 25, 0, 20, 0);
            ctx.bezierCurveTo(15, 0, 10, 3, 10, 10);
            ctx.fill();

            // Bar Background
            ctx.fillStyle = '#550000';
            ctx.fillRect(40, 5, barWidth, barHeight);

            // Health Fill
            ctx.fillStyle = '#ff0000';
            const healthPercent = Math.max(0, player.health / player.maxHealth);
            ctx.fillRect(40, 5, barWidth * healthPercent, barHeight);

            // Border
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.strokeRect(40, 5, barWidth, barHeight);

            ctx.restore();

            // Balance Bar
            ctx.save();
            ctx.translate(padding, padding + 60);

            // Money Icon ($)
            ctx.fillStyle = '#ffd700';
            ctx.font = 'bold 40px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('$', 15, 30);

            // Balance Text
            ctx.fillStyle = '#ffd700';
            ctx.font = 'bold 32px Courier New';
            ctx.textAlign = 'left';
            ctx.shadowColor = '#000';
            ctx.shadowBlur = 4;
            ctx.fillText(`$${player.money}`, 40, 30);
            ctx.shadowBlur = 0;

            ctx.restore();
        }

        // Collision Logic
        function checkCollisions() {
            // Obstacles
            for (let i = 0; i < obstacles.length; i++) {
                const obs = obstacles[i];
                if (
                    player.x < obs.x + obs.w &&
                    player.x + player.size > obs.x &&
                    player.y < obs.y + obs.h &&
                    player.y + player.size > obs.y
                ) {
                    const damage = Math.floor(20 / defense);
                    player.health -= damage;
                    obs.markedForDeletion = true;
                    if (player.health <= 0) gameState = 'GAMEOVER';
                }
            }

            // Coins
            for (let i = 0; i < coins.length; i++) {
                const c = coins[i];
                const coinSize = c.size * 2;
                if (
                    player.x < c.x + coinSize &&
                    player.x + player.size > c.x &&
                    player.y < c.y + coinSize &&
                    player.y + player.size > c.y
                ) {
                    player.money += Math.floor(100 * income);
                    c.markedForDeletion = true;
                }
            }
        }


        // Scotty Dog (Title Screen Only)
        // ... (Keep existing dogSprite and drawDog)
        const dogSprite = [
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1],
            [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 3, 1, 1, 1, 1],
            [1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1],
            [0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0],
            [0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0],
            [0, 0, 0, 1, 1, 2, 2, 1, 1, 1, 1, 1, 1, 1, 0, 0],
            [0, 0, 0, 1, 1, 2, 2, 1, 1, 1, 1, 1, 1, 0, 0, 0],
            [0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0],
            [0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0],
            [0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0],
            [0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0],
            [0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0]
        ];

        function drawDog(x, y, scale) {
            ctx.save();
            ctx.translate(x, y + Math.sin(Date.now() / 300) * 10);
            for (let r = 0; r < dogSprite.length; r++) {
                for (let c = 0; c < dogSprite[r].length; c++) {
                    const val = dogSprite[r][c];
                    if (val === 0) continue;
                    ctx.fillStyle = val === 1 ? '#111' : (val === 2 ? '#d00' : '#fff');
                    ctx.fillRect(c * scale, r * scale, scale, scale);
                }
            }
            ctx.restore();
        }

        // Loop
        function loop() {
            // clearRect to let background show through
            ctx.clearRect(0, 0, w, h);

            if (gameState === 'TITLE') {
                const scale = Math.min(w, h) / 40;
                const dogW = 16 * scale;
                drawDog((w - dogW) / 2, h * 0.25, scale);

            } else if (gameState === 'CHARACTERS') {
                // Pause game updates during character selection
                // Background animations continue via separate frame() loop
                requestAnimationFrame(loop);
                return;

            } else if (gameState === 'PATHS') {
                // Pause game updates during path selection
                // Background animations continue via separate frame() loop
                requestAnimationFrame(loop);
                return;

            } else if (gameState === 'PLAYING') {
                // Timer Logic
                gameTimer += 1 / 60; // Assuming 60fps
                const timeRemaining = Math.max(0, Math.ceil(GAME_INTERVAL - gameTimer));
                document.querySelector('.timer-display').textContent = timeRemaining;

                if (gameTimer >= GAME_INTERVAL) {
                    // Generate passive income
                    const passiveEarnings = Math.floor(player.money * (passiveIncome * 0.1));
                    player.money += passiveEarnings;

                    gameState = 'SHOP';
                    document.getElementById('shop-ui').classList.add('active');
                    // Draw the first tab's content
                    drawSkillsTree();
                    requestAnimationFrame(loop);
                    return; // Pause game updates
                }

                // Player Physics
                if (player.isThrusting) player.vy += player.thrust;
                else player.vy += player.gravity;

                if (player.vy > player.maxVy) player.vy = player.maxVy;
                if (player.vy < -player.maxVy) player.vy = -player.maxVy;
                player.y += player.vy;

                if (player.y < 0) { player.y = 0; player.vy = 0; }
                if (player.y > h - player.size) { player.y = h - player.size; player.vy = 0; }

                // Spawning
                obstacleTimer++;
                if (obstacleTimer > 60) {
                    obstacles.push(new Obstacle());
                    obstacleTimer = 0;
                }

                coinTimer++;
                if (coinTimer > 40) {
                    if (Math.random() > 0.5) coins.push(new Coin());
                    coinTimer = 0;
                }

                // Update & Draw Entities
                obstacles.forEach(o => { o.update(); o.draw(); });
                obstacles = obstacles.filter(o => !o.markedForDeletion);

                coins.forEach(c => { c.update(); c.draw(); });
                coins = coins.filter(c => !c.markedForDeletion);

                checkCollisions();

                // Draw Player
                ctx.fillStyle = '#fff';
                ctx.fillRect(player.x, player.y, player.size, player.size);

                drawUI();

            } else if (gameState === 'SHOP') {
                // Pause game updates while in shop
                // Background animations continue via separate frame() loop
                requestAnimationFrame(loop);
                return;

            } else if (gameState === 'GAMEOVER') {
                ctx.fillStyle = '#fff';
                ctx.font = '40px Courier New';
                ctx.textAlign = 'center';
                ctx.fillText('GAME OVER', w / 2, h / 2);
                ctx.font = '20px Courier New';
                ctx.fillText(`Final Money: $${player.money}`, w / 2, h / 2 + 40);
                ctx.fillText('Click to Title', w / 2, h / 2 + 80);
            }

            requestAnimationFrame(loop);
        }

        loop();
    </script>
</body>

</html>