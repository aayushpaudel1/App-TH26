<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doobert Royale</title>
    <style>
        body {
            margin: 0;
            background: #0f0c29;
            overflow: hidden;
            font-family: 'Segoe UI', sans-serif;
        }

        canvas {
            display: block;
        }
    </style>
</head>

<body>
    <canvas id="c"></canvas>

    <script>
        const c = document.getElementById('c');
        const ctx = c.getContext('2d');
        let w, h;

        // --- ASSETS ---
        // 1. Shared Definitions (Gradients)
        const SVG_DEFS = `
            <defs>
                <linearGradient id="tartanGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#cc0000" />
                    <stop offset="25%" stop-color="#006600" />
                    <stop offset="50%" stop-color="#000066" />
                    <stop offset="75%" stop-color="#ffff00" />
                    <stop offset="100%" stop-color="#cc0000" />
                </linearGradient>
                <linearGradient id="lensGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" stop-color="#00f3ff" />
                    <stop offset="100%" stop-color="#d400ff" />
                </linearGradient>
            </defs>
        `;

        // 2. CSS Styles extracted from index.html
        const SVG_STYLE = `
            <style>
                .terrier-head { fill: #1a1a1a; stroke: #333; stroke-width: 2; }
                .terrier-body { fill: #0d0d0d; stroke: #2a2a2a; stroke-width: 1.5; }
                .shaggy-fur { stroke: #3a3a3a; stroke-width: 1.5; fill: none; }
                .bowtie { fill: url(#tartanGradient); stroke: #000; stroke-width: 1; }
                .ear-highlight { fill: none; stroke: #444; stroke-width: 2; }
                .scotty-eye { fill: #000; stroke: #fff; stroke-width: 0.5; }
                .scotty-snout { fill: #2a2a2a; }
                .scotty-beard { fill: #1a1a1a; stroke: #3a3a3a; stroke-width: 1; }
                
                .husky-fur { fill: #e0e0e0; }
                .husky-mask { fill: #304050; }
                .glasses-frame { fill: #111; stroke: #ff00ff; stroke-width: 1; }
                .glasses-lens { fill: url(#lensGradient); opacity: 0.8; }
                .crypto-glint { fill: #fff; opacity: 0.8; }
                
                .golden-fur { fill: #d4af37; }
                .golden-snoot { fill: #ffeebb; }
                .reading-glasses { fill: none; stroke: #000; stroke-width: 1.5; }
                .glass-lens-clear { fill: rgba(255, 255, 255, 0.2); }
                
                .corgi-fur-orange { fill: #d67828; }
                .corgi-fur-white { fill: #fff; }
                .crown { fill: #ffd700; stroke: #b8860b; stroke-width: 1; }
                .gem { fill: #ff0000; }
                
                .fur-orange { fill: #d4834f; }
                .fur-cream { fill: #f5deb3; }
                .helmet-yellow { fill: #ffcc00; stroke: #b8860b; stroke-width: 1; }
                .helmet-stripe { fill: #fff; opacity: 0.8; }
                
                .fur-grey { fill: #777; }
                .fur-white-patch { fill: #ddd; }
                .hard-hat { fill: #ffaa00; stroke: #cc8800; stroke-width: 1; }
                .collar-blue { fill: #0044ff; stroke: #002288; stroke-width: 1; }
                .muscle-line { fill: none; stroke: #555; stroke-width: 1; opacity: 0.5; }
            </style>
        `;

        // 3. SVG Bodies (Wrapped)
        function wrapSVG(content) {
            // Updated to use tartanGradient instead of missing pattern
            const fixedContent = content.replace(/url\(#tartanPattern\)/g, 'url(#tartanGradient)');
            return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 120">${SVG_DEFS}${SVG_STYLE}${fixedContent}</svg>`;
        }

        const DOG_SVGS = {
            scotty: wrapSVG(`
                <ellipse cx="50" cy="65" rx="22" ry="18" class="terrier-body" />
                <rect x="30" y="75" width="12" height="15" class="terrier-body" rx="6" />
                <rect x="60" y="75" width="12" height="15" class="terrier-body" rx="6" />
                <path d="M30 50 L 70 50 L 50 78 Z" fill="url(#tartanGradient)" stroke="#000" stroke-width="1" />
                <ellipse cx="50" cy="42" rx="20" ry="22" class="terrier-head" />
                <path d="M35 30 L 32 15 L 40 28 Z" class="terrier-head" />
                <path d="M65 30 L 68 15 L 60 28 Z" class="terrier-head" />
                <path d="M36 28 L 34 20 L 39 28 Z" class="ear-highlight" />
                <path d="M64 28 L 66 20 L 61 28 Z" class="ear-highlight" />
                <path d="M32 38 Q 28 42, 30 46" class="shaggy-fur" />
                <path d="M68 38 Q 72 42, 70 46" class="shaggy-fur" />
                <path d="M35 50 Q 32 54, 34 58" class="shaggy-fur" />
                <path d="M65 50 Q 68 54, 66 58" class="shaggy-fur" />
                <ellipse cx="50" cy="56" rx="14" ry="10" class="scotty-beard" />
                <path d="M40 58 Q 38 62, 40 64" class="shaggy-fur" />
                <path d="M60 58 Q 62 62, 60 64" class="shaggy-fur" />
                <ellipse cx="50" cy="52" rx="8" ry="6" class="scotty-snout" />
                <circle cx="43" cy="42" r="3" class="scotty-eye" />
                <circle cx="57" cy="42" r="3" class="scotty-eye" />
                <ellipse cx="50" cy="52" rx="3" ry="2.5" fill="#000" />
            `),
            husky: wrapSVG(`
                <path class="husky-fur" d="M20 40 L 30 10 L 40 30 L 60 30 L 70 10 L 80 40 L 85 70 Q 50 85, 15 70 Z" />
                <path class="husky-mask" d="M20 40 L 40 30 L 50 50 L 60 30 L 80 40 L 75 60 Q 50 70, 25 60 Z" />
                <path class="husky-fur" d="M40 30 L 50 50 L 60 30" />
                <path class="glasses-frame" d="M25 45 H 75 V 55 H 25 Z" />
                <rect class="glasses-lens" x="27" y="47" width="20" height="6" />
                <rect class="glasses-lens" x="53" y="47" width="20" height="6" />
                <path d="M50 48 L 50 45" stroke="#111" stroke-width="2" />
                <path class="crypto-glint" d="M30 47 L 35 47 L 32 53 Z" />
                <ellipse cx="50" cy="58" rx="10" ry="8" class="husky-fur" />
                <path d="M42 55 Q 50 52, 58 55" fill="none" stroke="#ddd" stroke-width="1" />
                <ellipse cx="50" cy="54" rx="4" ry="3" fill="#111" />
                <path d="M45 62 Q 50 64, 55 61" fill="none" stroke="#111" stroke-width="1.5" />
            `),
            golden: wrapSVG(`
                <path d="M30 110 L 40 60 Q 50 50, 60 60 L 70 110 Z" class="golden-fur" />
                <ellipse cx="35" cy="110" rx="8" ry="5" class="golden-fur" />
                <ellipse cx="65" cy="110" rx="8" ry="5" class="golden-fur" />
                <ellipse cx="40" cy="100" rx="6" ry="10" class="golden-fur" />
                <ellipse cx="60" cy="100" rx="6" ry="10" class="golden-fur" />
                <g transform="translate(0, 10)">
                    <ellipse cx="50" cy="45" rx="22" ry="25" class="golden-fur" />
                    <ellipse cx="30" cy="40" rx="8" ry="15" class="golden-fur" />
                    <ellipse cx="70" cy="40" rx="8" ry="15" class="golden-fur" />
                    <ellipse cx="50" cy="55" rx="12" ry="10" class="golden-snoot" />
                    <circle cx="42" cy="42" r="3" fill="#000" />
                    <circle cx="58" cy="42" r="3" fill="#000" />
                    <circle cx="50" cy="55" r="3" fill="#000" />
                    <circle class="glass-lens-clear" cx="42" cy="42" r="6" stroke="#000" stroke-width="1.5" />
                    <circle class="glass-lens-clear" cx="58" cy="42" r="6" stroke="#000" stroke-width="1.5" />
                    <line x1="48" y1="42" x2="52" y2="42" stroke="#000" stroke-width="1.5" />
                </g>
            `),
            corgi: wrapSVG(`
                <path d="M30 60 L 70 60 L 80 110 L 20 110 Z" fill="#990000" stroke="#ffd700" stroke-width="1" />
                <rect x="25" y="70" width="50" height="30" rx="10" class="corgi-fur-orange" />
                <rect x="35" y="70" width="30" height="30" rx="10" class="corgi-fur-white" opacity="0.5" />
                <rect x="25" y="95" width="8" height="15" rx="3" class="corgi-fur-orange" />
                <rect x="67" y="95" width="8" height="15" rx="3" class="corgi-fur-orange" />
                <g transform="translate(0, 15)">
                    <ellipse cx="50" cy="50" rx="20" ry="22" class="corgi-fur-orange" />
                    <ellipse cx="35" cy="35" rx="7" ry="12" class="corgi-fur-orange" />
                    <ellipse cx="65" cy="35" rx="7" ry="12" class="corgi-fur-orange" />
                    <ellipse cx="50" cy="50" rx="8" ry="15" class="corgi-fur-white" />
                    <circle cx="42" cy="47" r="3" fill="#000" />
                    <circle cx="58" cy="47" r="3" fill="#000" />
                    <circle cx="50" cy="58" r="3" fill="#000" />
                    <path d="M45 62 Q 50 65, 55 62" fill="none" stroke="#000" stroke-width="1.5" />
                    <g class="crown">
                        <path d="M35 28 L 38 20 L 43 25 L 50 18 L 57 25 L 62 20 L 65 28 L 35 28 Z" />
                        <circle class="gem" cx="50" cy="24" r="2" />
                    </g>
                </g>
            `),
            shiba: wrapSVG(`
                <rect x="30" y="60" width="40" height="40" rx="10" class="fur-orange" />
                <rect x="35" y="65" width="30" height="30" rx="8" class="fur-cream" opacity="0.6" />
                <rect x="32" y="90" width="8" height="20" rx="3" class="fur-orange" />
                <rect x="60" y="90" width="8" height="20" rx="3" class="fur-orange" />
                <g transform="translate(0, 10)">
                    <ellipse cx="50" cy="50" rx="22" ry="24" class="fur-orange" />
                    <path d="M35 35 L 30 20 L 40 30 Z" class="fur-orange" />
                    <path d="M65 35 L 70 20 L 60 30 Z" class="fur-orange" />
                    <path d="M35 32 L 32 22 L 38 30 Z" class="fur-cream" />
                    <path d="M65 32 L 68 22 L 62 30 Z" class="fur-cream" />
                    <ellipse cx="50" cy="58" rx="14" ry="10" class="fur-cream" />
                    <ellipse cx="42" cy="48" rx="3" ry="4" fill="#000" />
                    <ellipse cx="58" cy="48" rx="3" ry="4" fill="#000" />
                    <circle cx="50" cy="60" r="3" fill="#000" />
                    <path d="M42 64 Q 50 68, 58 64" fill="none" stroke="#000" stroke-width="1.5" />
                    <ellipse cx="50" cy="28" rx="18" ry="10" class="helmet-yellow" />
                    <rect x="32" y="34" width="36" height="4" class="helmet-yellow" rx="2" />
                </g>
            `),
            pitbull: wrapSVG(`
                <rect x="25" y="60" width="50" height="40" rx="10" class="fur-grey" />
                <path d="M30 65 L 70 65" class="muscle-line" />
                <rect x="25" y="90" width="12" height="20" rx="3" class="fur-grey" />
                <rect x="63" y="90" width="12" height="20" rx="3" class="fur-grey" />
                <g transform="translate(0, 10)">
                    <ellipse cx="50" cy="50" rx="25" ry="22" class="fur-grey" />
                    <ellipse cx="32" cy="38" rx="6" ry="8" class="fur-grey" />
                    <ellipse cx="68" cy="38" rx="6" ry="8" class="fur-grey" />
                    <ellipse cx="50" cy="65" rx="10" ry="8" class="fur-white-patch" />
                    <circle cx="42" cy="48" r="3" fill="#000" />
                    <circle cx="58" cy="48" r="3" fill="#000" />
                    <ellipse cx="50" cy="58" rx="4" ry="3" fill="#000" />
                    <path d="M45 60 L 50 62 L 55 60" fill="none" stroke="#000" stroke-width="2" />
                    <ellipse cx="50" cy="32" rx="22" ry="10" class="hard-hat" />
                    <rect x="28" y="38" width="44" height="4" class="hard-hat" rx="1" />
                    <ellipse cx="50" cy="68" rx="18" ry="5" class="collar-blue" />
                    <circle cx="50" cy="68" r="3" fill="#ffd700" />
                </g>
            `)
        };

        const loadedIcons = {};
        const iconKeys = Object.keys(DOG_SVGS);

        Object.keys(DOG_SVGS).forEach(key => {
            const img = new Image();
            const svgKey = DOG_SVGS[key].trim();
            img.src = 'data:image/svg+xml;base64,' + btoa(svgKey);
            img.onload = () => {
                loadedIcons[key] = img;
            };
        });

        // --- DATA ---
        const botNames = [
            "DogeCoin", "BarkCuban", "ElonTusk", "WarrenBuffet", "SnoopDogg",
            "BezosBark", "GateKeeper", "ZuckerBone", "BuffetDog", "CryptoShiba",
            "NFTerrier", "BlockchainBully", "StonkHound", "DiamondPaws", "HodlHusky",
            "PaperHandsPug", "MoonMoon", "RocketRover", "TeslaTerrier", "AmazonAlta",
            "GoogleGolden", "AppleAiredale", "MetaMutt", "NetflixNewfie", "SpotifySpaniel",
            "UberUnderdog", "LyftLab", "AirbnbAkita", "DoorDashDoxie", "InstacartIggy",
            "RobinhoodRetriever", "FidelityFox", "VanguardVizsla", "SchwabSheepdog", "ChaseChihuahua",
            "WellsFargoWestie", "CitiCorgi", "AmexAlsatian", "VisaVizsla", "MastercardMastiff",
            "PayPalPointer", "VenmoVizsla", "CashAppCorgi", "SquareSchnauzer", "StripeSetter",
            "ShopifyShiba", "EtsyEskimo", "ZoomZuchon", "SlackSheepdog", "TrelloTerrier",
            "AsanaAkita", "JiraJack", "GitHubGreyhound", "GitLabGolden", "BitBucketBeagle",
            "DockerDoberman", "KubernetesKelpie", "AwsAkita", "AzureAlsatian", "GcpGreyhound",
            "OracleOtterhound", "SapSheepdog", "SalesforceSpaniel", "AdobeAkita", "IntelIggy",
            "AmdAlsatian", "NvidiaNewfie", "TsmcTerrier", "SamsungSetter", "SonySpaniel",
            "NintendoNewfie", "MicrosoftMutt", "IbmIggy", "DellDoberman", "HpHusky",
            "LenovoLab", "AsusAkita", "AcerAlsatian", "ToshibaTerrier", "PanasonicPug",
            "LgLab", "CanonCorgi", "NikonNewfie", "FujifilmFox", "OlympusOtterhound",
            "LeicaLab", "HasbroHusky", "MattelMutt", "LegoLab", "NerfNewfie",
            "BarbieBeagle", "HotWheelsHusky", "FisherPriceFox", "PlayDohPug", "CrayolaCorgi",
            "DisneyDoberman", "WarnerWestie", "UniversalUnderdog", "ParamountPug"
        ];

        while (botNames.length < 99) botNames.push("Bot" + botNames.length);

        let bots = botNames.slice(0, 99).map(name => ({
            name: name,
            netWorth: 800 + Math.random() * 400,
            alive: true,
            icon: iconKeys[Math.floor(Math.random() * iconKeys.length)]
        }));

        let player = {
            name: "YOU",
            netWorth: 1000,
            alive: true,
            isPlayer: true,
            icon: 'scotty'
        };

        let allEntities = [...bots, player];
        let year = 1;
        let bankruptCount = 0;
        let lastRoundBankruptMsg = "";
        let showingLeaderboard = false;
        let lbTimer = 0;

        // --- SIMULATION ---
        function updateMarket() {
            let roundsBankrupt = 0;
            bots.forEach(bot => {
                if (!bot.alive) return;

                // High Volatility: -60% to +80% (Increased + Adjusted Bias)
                const change = (Math.random() - 0.52) * 1.5;
                bot.netWorth *= (1 + change);

                if (bot.netWorth < 300) { // Higher Threshold
                    bot.alive = false;
                    bot.netWorth = 0;
                    bankruptCount++;
                    roundsBankrupt++;
                }
            });

            // Player logic
            player.netWorth *= (1 + (Math.random() - 0.4) * 0.5);
            if (player.netWorth < 0) player.netWorth = 0;
            year++;

            if (roundsBankrupt > 0) {
                lastRoundBankruptMsg = `ðŸ’€ ${roundsBankrupt} DOGS WENT BANKRUPT!`;
            } else {
                lastRoundBankruptMsg = "âœ… NO OTHER DOGS WENT BANKRUPT!";
            }

            return roundsBankrupt;
        }

        // --- UI UTILS ---
        function roundRect(ctx, x, y, w, h, r) {
            if (w < 2 * r) r = w / 2;
            if (h < 2 * r) r = h / 2;
            ctx.beginPath();
            ctx.moveTo(x + r, y);
            ctx.arcTo(x + w, y, x + w, y + h, r);
            ctx.arcTo(x + w, y + h, x, y + h, r);
            ctx.arcTo(x, y + h, x, y, r);
            ctx.arcTo(x, y, x + w, y, r);
            ctx.closePath();
        }

        function drawLeaderboard() {
            // Sort
            allEntities.sort((a, b) => b.netWorth - a.netWorth);
            const rank = allEntities.indexOf(player);

            // Overlay with gradient
            const grad = ctx.createLinearGradient(0, 0, w, h);
            grad.addColorStop(0, 'rgba(15, 12, 41, 0.95)');
            grad.addColorStop(1, 'rgba(48, 43, 99, 0.98)');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, w, h);

            // Responsive Params
            const cardW = Math.min(600, w - 40);
            const cardH = w < 400 ? 60 : 80;
            const gap = 15;
            const headerBottom = 230;

            // Layout Calculations
            const totalH = 5 * (cardH + gap);
            let startY = (h - totalH) / 2 + 40;
            if (startY < headerBottom) startY = headerBottom;

            // Header
            ctx.shadowBlur = 0;
            ctx.textAlign = 'center';

            ctx.fillStyle = '#facc15';
            ctx.font = 'bold 20px Segoe UI';
            ctx.fillText(`YEAR ${year} ENDED`, w / 2, 80);

            ctx.fillStyle = '#fff';
            const titleSize = w < 400 ? '36px' : '48px';
            ctx.font = `800 ${titleSize} Segoe UI`;
            ctx.fillText("LEADERBOARD", w / 2, 130);

            // Bankrupt Message
            if (lastRoundBankruptMsg.includes("âœ…")) {
                ctx.fillStyle = '#4ade80';
            } else {
                ctx.fillStyle = '#ef4444';
            }
            ctx.font = 'bold 20px Segoe UI';
            ctx.fillText(lastRoundBankruptMsg, w / 2, 170);

            // Cards Logic
            let startIndex = Math.max(0, rank - 2);
            let endIndex = Math.min(allEntities.length, rank + 3);
            if (endIndex - startIndex < 5) {
                if (startIndex === 0) endIndex = Math.min(allEntities.length, 5);
                else startIndex = Math.max(0, allEntities.length - 5);
            }

            ctx.textAlign = 'left';

            for (let i = startIndex; i < endIndex; i++) {
                const entity = allEntities[i];
                const y = startY + (i - startIndex) * (cardH + gap);
                const isPlayer = entity === player;

                // Card Background
                ctx.save();
                ctx.shadowColor = 'rgba(0,0,0,0.5)';
                ctx.shadowBlur = 20;
                ctx.shadowOffsetY = 10;

                if (isPlayer) {
                    const highlight = ctx.createLinearGradient(w / 2 - cardW / 2, y, w / 2 + cardW / 2, y + cardH);
                    highlight.addColorStop(0, 'rgba(250, 204, 21, 0.2)');
                    highlight.addColorStop(1, 'rgba(250, 204, 21, 0.05)');
                    ctx.fillStyle = highlight;
                    ctx.strokeStyle = '#facc15';
                } else if (!entity.alive) {
                    ctx.fillStyle = 'rgba(239, 68, 68, 0.1)';
                    ctx.strokeStyle = 'rgba(239, 68, 68, 0.3)';
                } else {
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.05)';
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                }

                roundRect(ctx, w / 2 - cardW / 2, y, cardW, cardH, 15);
                ctx.fill();
                ctx.lineWidth = isPlayer ? 2 : 1;
                ctx.stroke();
                ctx.restore();

                // Draw Icon
                const iconSize = cardH - 20;
                if (loadedIcons[entity.icon]) {
                    ctx.drawImage(loadedIcons[entity.icon], w / 2 - cardW / 2 + 20, y + 10, iconSize, iconSize);
                }

                // Fonts
                const nameSize = w < 400 ? '16px' : '24px';
                const rankSize = w < 400 ? '14px' : '20px';
                const moneySize = w < 400 ? '16px' : '24px';

                // Rank
                ctx.fillStyle = isPlayer ? '#facc15' : '#94a3b8';
                ctx.font = `bold ${rankSize} Segoe UI`;
                ctx.fillText(`#${i + 1}`, w / 2 - cardW / 2 + iconSize + 30, y + cardH * 0.3);

                // Name
                ctx.fillStyle = isPlayer ? '#fff' : (entity.alive ? '#e2e8f0' : '#ef4444');
                ctx.font = isPlayer ? `bold ${nameSize} Segoe UI` : `600 ${nameSize} Segoe UI`;
                ctx.fillText(entity.name, w / 2 - cardW / 2 + iconSize + 30, y + cardH * 0.7);

                // Net Worth
                ctx.textAlign = 'right';
                const moneyStr = `$${Math.floor(entity.netWorth).toLocaleString()}`;

                if (!entity.alive) {
                    ctx.font = `bold ${moneySize} Segoe UI`;
                    ctx.fillStyle = '#ef4444';
                    ctx.fillText("BANKRUPT", w / 2 + cardW / 2 - 20, y + cardH / 2 + 8);
                } else {
                    ctx.font = isPlayer ? `bold ${moneySize} Segoe UI` : `${moneySize} Segoe UI`;
                    ctx.fillStyle = '#4ade80';
                    ctx.fillText(moneyStr, w / 2 + cardW / 2 - 20, y + cardH / 2 + 8);
                }
                ctx.textAlign = 'left';
            }
        }

        function loop() {
            const dpr = window.devicePixelRatio || 1;
            w = window.innerWidth;
            h = window.innerHeight;

            c.width = w * dpr;
            c.height = h * dpr;
            c.style.width = `${w}px`;
            c.style.height = `${h}px`;

            ctx.scale(dpr, dpr);

            if (showingLeaderboard) {
                drawLeaderboard();
                lbTimer--;
                if (lbTimer <= 0) showingLeaderboard = false;
            } else {
                ctx.fillStyle = '#1e293b';
                ctx.fillRect(0, 0, w, h);

                ctx.fillStyle = '#94a3b8';
                ctx.font = '24px Segoe UI';
                ctx.textAlign = 'center';
                ctx.fillText("Running Level... (Wait for Year End)", w / 2, h / 2);

                if (Math.random() < 0.015) {
                    updateMarket();
                    showingLeaderboard = true;
                    lbTimer = 180;
                }
            }
            requestAnimationFrame(loop);
        }

        loop();
    </script>
</body>

</html>